<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Procvičování počítání</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f2f5;
            color: #333;
        }
        .container {
            text-align: center;
            background-color: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 400px;
        }
        h1 {
            color: #007bff;
        }
        #timer {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #dc3545;
            font-weight: bold;
        }
        #problem {
            font-size: 2.5em;
            margin-bottom: 20px;
            font-weight: bold;
        }
        #answer {
            width: 100px;
            height: 50px;
            font-size: 2em;
            text-align: center;
            border: 2px solid #ccc;
            border-radius: 5px;
        }
        #start-button {
            padding: 15px 30px;
            font-size: 1.2em;
            cursor: pointer;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        #start-button:hover {
            background-color: #218838;
        }
        #results {
            font-size: 1.2em;
        }
        #results h2 {
            color: #007bff;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Počítání do 20</h1>
    <div id="game">
        <button id="start-button">Start</button>
        <div id="game-area" style="display: none;">
            <div id="timer">Čas: 60s</div>
            <div id="problem"></div>
            <input type="number" id="answer" autofocus>
        </div>
    </div>
    <div id="results" style="display: none;">
        <h2>Čas vypršel!</h2>
        <p id="score"></p>
        <p id="accuracy"></p>
    </div>
    <div id="log-container" style="display: none; margin-top: 20px; text-align: left;">
        <h3>Protokol odpovědí:</h3>
        <div id="log-entries"></div>
    </div>
</div>

<script>
    const startButton = document.getElementById('start-button');
    const gameArea = document.getElementById('game-area');
    const timerEl = document.getElementById('timer');
    const problemEl = document.getElementById('problem');
    const answerEl = document.getElementById('answer');
    const resultsEl = document.getElementById('results');
    const scoreEl = document.getElementById('score');
    const accuracyEl = document.getElementById('accuracy');
    const logContainerEl = document.getElementById('log-container');
    const logEntriesEl = document.getElementById('log-entries');

    let correctAnswers = 0;
    let totalQuestions = 0;
    let currentCorrectAnswer;
    let timer;
    let timeLeft = 60;
    let answerLog = [];

    startButton.addEventListener('click', startGame);

    function startGame() {
        startButton.style.display = 'none';
        gameArea.style.display = 'block';
        answerEl.focus();
        correctAnswers = 0;
        totalQuestions = 0;
        timeLeft = 60;
        answerLog = [];
        logContainerEl.style.display = 'none';
        logEntriesEl.innerHTML = '';
        
        generateProblem();
        startTimer();
    }

    function startTimer() {
        timerEl.textContent = `Čas: ${timeLeft}s`;
        timer = setInterval(() => {
            timeLeft--;
            timerEl.textContent = `Čas: ${timeLeft}s`;
            if (timeLeft <= 0) {
                clearInterval(timer);
                endGame();
            }
        }, 1000);
    }

    function generateNumberWithLessZero(max) {
        if (max <= 0) return 0;
        // Total "tickets": 1 for 0, 2 for 1, ..., 2 for max. Total = 1 + 2*max.
        const k = Math.floor(Math.random() * (1 + 2 * max)); // Range: 0 to 2*max
        if (k === 0) {
            return 0;
        }
        // k is from 1 to 2*max. Map to 1 to max.
        return Math.floor((k - 1) / 2) + 1;
    }

    function generateProblem() {
        let num1, num2, isAddition, tempCorrectAnswer;

        do {
            isAddition = Math.random() > 0.5;
            if (isAddition) {
                num1 = generateNumberWithLessZero(20);
                num2 = generateNumberWithLessZero(20 - num1);
                tempCorrectAnswer = num1 + num2;
            } else { // Subtraction
                num1 = generateNumberWithLessZero(20);
                num2 = generateNumberWithLessZero(num1);
                tempCorrectAnswer = num1 - num2;
            }
        } while (tempCorrectAnswer === 0 && Math.random() > 0.5); // Reroll if result is 0 and coin toss fails

        currentCorrectAnswer = tempCorrectAnswer;
        problemEl.textContent = isAddition ? `${num1} + ${num2} =` : `${num1} - ${num2} =`;
    }

    answerEl.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            if (answerEl.value === '') return;
            
            const userAnswer = parseInt(answerEl.value);
            const isCorrect = userAnswer === currentCorrectAnswer;
            
            totalQuestions++;
            if (isCorrect) {
                correctAnswers++;
            }

            answerLog.push({
                problem: problemEl.textContent,
                userAnswer: userAnswer,
                correctAnswer: currentCorrectAnswer,
                isCorrect: isCorrect
            });
            
            answerEl.value = '';
            generateProblem();
        }
    });

    function endGame() {
        gameArea.style.display = 'none';
        resultsEl.style.display = 'block';

        scoreEl.textContent = `Počet vypočítaných příkladů: ${totalQuestions}`;
        const accuracy = totalQuestions > 0 ? ((correctAnswers / totalQuestions) * 100).toFixed(1) : 0;
        accuracyEl.textContent = `Úspěšnost: ${accuracy}% (${correctAnswers} z ${totalQuestions} správně)`;

        if (totalQuestions > 0) {
            logContainerEl.style.display = 'block';
            answerLog.forEach(log => {
                const logEntry = document.createElement('div');
                logEntry.innerHTML = `
                    ${log.problem} <strong>${log.correctAnswer}</strong>. 
                    Vaše odpověď: <strong>${log.userAnswer}</strong> 
                    ${log.isCorrect ? '<span>&#10003;</span>' : '<span>&#10007;</span>'}
                `;
                logEntry.style.color = log.isCorrect ? 'green' : 'red';
                logEntry.style.marginBottom = '5px';
                logEntriesEl.appendChild(logEntry);
            });
        }
    }

</script>

</body>
</html>
